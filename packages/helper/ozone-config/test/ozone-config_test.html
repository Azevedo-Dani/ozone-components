<!doctype html>
<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <title>ozone-manage-connection</title>

  <script src="../../webcomponentsjs/webcomponents-lite.js"></script>
  <script src="../../web-component-tester/browser.js"></script>

  <!-- Step 1: import the element to test -->
  <script src="../dist.ozone-config.js"></script>


</head>
<body>


<script>
  describe('ozone-config tests', function() {
    let afterFunctions = [],
      server,
      responseHeaders = {json: {'Content-Type': 'application/json'}};

    beforeEach((done) => {
      server = sinon.fakeServer.create();
      flush(done);
    });
    afterEach(() => {
      afterFunctions.map((cleanup) => {
        cleanup()
      });
      afterFunctions = [];
    });

    it('should request ozone config file and expose config in configPromise', (done) => {
      // -- Configure mock server
      server.respondWith(
        'GET',
        "./conf.ozone.json",
        [
          200,
          responseHeaders.json,
          '{"ozoneApi": {"server": "https://alpha.flowr.cloud/","endpoint": "ozone/"}}'
        ]
      );
      // -- start test

      OzoneConfig.get().then(function(config){
        expect(config).to.deep.equal({server: "https://alpha.flowr.cloud/",endpoint: "ozone/"});
      })
        .then(() => done())
        .catch((e) => {
          done(e)
        });
      server.respond(); //Flush server
    });

    it('should catch error in configPromise', (done) => {

      // -- Configure mock server
      server.respondWith(
        'GET',
        "./conf.ozone.json",
        [
          400,
          responseHeaders.json,
          ''
        ]
      );
      // -- start test
      OzoneConfig.get().catch((event) => {
        assert.isDefined(event.detail.error);
        done()
      });
      server.respond(); //Flush server
    });
  });
</script>
